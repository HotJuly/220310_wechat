#  跨域相关

1. 问题一:什么是跨域

   1. 违反了浏览器的同源策略,就称为跨域

   2. 什么是浏览器的同源策略?

      1. 如果两个 URL 的协议名、域名以及端口号都相同的话，则这两个 URL 是同源

      2. ```javascript
         //案例1:以下两个链接,协议名不相同,所以不同源
         	http://localhost:3000/home
         	ftp://localhost:3000/home

         //案例2:以下两个链接,端口号不相同,所以不同源
         	http://localhost:3000/home
         	http://localhost:8080/home

         //案例2:以下两个链接,协议名,域名,端口号都相同,所以是同源
         	http://localhost:3000/about?a=2
         	http://localhost:3000/home?a=1
         ```

         ​

      3. 一个链接的组成部分:

         1. 协议名+域名(主机地址)+端口号+查询字符串
            1. 其中/home?a=1,是由路由路径和query参数拼接而成,统称为查询字符串
            2. 查询字符串不在同源的判断范围之内

      4. **问题:为什么浏览器要报跨域错误,为什么需要有同源策略?**

         1. **如果协议名不同不会报跨域错误,就会导致当前网页,使用ajax发送ftp等协议,获取用户电脑上的文件,并将其发往自家服务器上,导致用户隐私数据丢失**
         2. **如果域名不同不会报跨域错误,就会导致,用户登录假QQ网站的时候,假QQ网站使用ajax请求真QQ网站,ajax会自动携带与真QQ网站相关的cookie数据,那么真QQ网站根据cookie中的数据进行身份识别,最终将数据全部返回到假QQ的网页,从而被不法分子获取到**

2. 问题二:跨域一定会报错吗?

   1. 不一定
   2. 服务器之间不存在跨域问题
   3. img/audio/video/link/script等标签

3. 问题三:什么情况下会出现跨域问题

   1. 在浏览器上可能会出现跨域问题
   2. 只有在ajax请求的时候才会报跨域问题
   3. **小总结:跨域问题是浏览器搞的鬼**

4. 问题四:哪些请求算是ajax请求(async javascript and xml)

   1. 只有通过js发送的请求才有能是ajax请求
   2. 简单说法:发送一个ajax请求
   3. 完整说法:使用ajax技术发送一个http请求
   4. **浏览器中需要区分http请求和ajax请求,但是对于服务器来说都一样**
   5. **小总结:ajax不是一种特殊的请求,他只是一种发送http请求的技术**

5. 跨域问题解决方案

   1. JSONP

      1. 原理:script标签请求跨域资源,不会报跨域错误
      2. 流程:
         1. 在前端准备一个存储数据的变量,和一个接收数据的函数
         2. 当用户点击按钮的时候,给页面上添加一个script标签
         3. 给script标签添加src属性,属性值是服务器的接口地址,并且将接收数据的函数名称进行拼接
         4. 服务器接收到请求后,根据传过来的函数名称以及想要返回的数据进行拼接,得到相应的字符串
         5. 最终将该字符串返回前端,被script标签当作js代码在前端进行执行

   2. CORS(跨域资源共享)

      1. 原理:跨域问题是浏览器搞的鬼

      2. 跨域问题是在响应阶段才会报错的,因为浏览器检测到请求地址不同源

      3. 只要服务器告知浏览器,允许当前网页跨域请求自己就可以

      4. 流程:

         1. 服务器在返回的响应头中进行配置即可

         2. ```javascript
            Access-Control-Allow-Origin: http://map.baidu.com,http://www.baidu.com
            ```

   3. proxy


